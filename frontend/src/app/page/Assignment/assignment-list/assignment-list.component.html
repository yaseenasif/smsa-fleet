<div class="flex flex-row">
  <app-sidebar></app-sidebar>
  <div class="body-position">
    <div class="body-holder">
      <app-dashboard-head></app-dashboard-head>

      <div class="main">
        <p-toast></p-toast>
        <div class="card flex justify-content-center">
          <p-breadcrumb class="max-w-full" [model]="items"></p-breadcrumb>
          <p-button class="bg-b-color adjust mt-2" (click)="downloadExcelData()">
            <i class="bi bi-download"></i>&nbsp; Export data
          </p-button>
        </div>
        <div class="body-card">
          <div class="table-head">
            <div class="flex justify-content-between">
              <div class="flex align-items-center">
                <p-button
                  label="Clear"
                  class="bg-b-color"
                  (onClick)="clear()"
                  icon="pi pi-filter-slash"
                ></p-button>
              </div>
              <div class="mb-1">
                <p-button class="bg-b-color" routerLink="/add-assignment">
                  <i
                    class="bi bi-plus-lg"
                    style="font-size: 20px; font-weight: bold"
                  ></i
                  >&nbsp;Add Vehicle Assignment
                </p-button>
              </div>
            </div>
            <p-toolbar [style]="{ 'padding-top': '1.5rem' }">
              <div class="p-toolbar-group-start h-color">
                <strong> Search By :&nbsp; </strong>
                <span class="p-float-label">
                  <p-dropdown
                    [options]="vehicleAssignment"
                    (onChange)="getAllVehicleAssignmentByPlateNum($event.value)"
                    optionLabel="vehicle.plateNumber"
                    optionValue="vehicle.plateNumber"
                    placeholder="Plate No#"
                    [(ngModel)]="plateNumber"
                    [filter]="true"
                    dropdownicon="true"
                    [showClear]="true"
                    inputId="float-plateNumber"
                    filterBy="vehicle.plateNumber"
                    [disabled]="empNoSearch || criteriaSearch || vehicleAssignmentType"
                  ></p-dropdown>
                  <label for="float-plateNumber">Plate No#</label>
                </span>
              </div>
              <div class="p-toolbar-group-start h-color">
                <span class="p-float-label">
                  <p-dropdown
                    [options]="vehicleAssignment"
                    (onChange)="
                      getAllVehicleAssignmentByEmployeeNum($event.value)
                    "
                    optionLabel="assignToEmpId.employeeNumber"
                    optionValue="assignToEmpId.employeeNumber"
                    placeholder="Employee No#"
                    [filter]="true"
                    [(ngModel)]="employeeNumber"
                    inputId="float-empNo"
                    [showClear]="true"
                    filterBy="assignToEmpId.employeeNumber"
                    [disabled]="plateNoSearch || criteriaSearch || vehicleAssignmentType"
                  ></p-dropdown>
                  <label for="float-empNo">Employee No#</label>
                </span>
              </div>

              <div class="p-toolbar-group-start h-color">
                <span class="p-float-label">
                  <p-dropdown
                    [options]="vehicleAssignmentTypes"
                    [(ngModel)]="slectedAssignmentType"
                    optionLabel="label"
                    optionValue="value"
                    (onChange)="searchByAssignmentType($event.value)"
                    placeholder="Assignment Type"
                    inputId="float-vehicleAssignmentStatusType"
                    [showClear]="true"
                    [disabled]="plateNoSearch || criteriaSearch || empNoSearch"
                  ></p-dropdown>
                  <label for="float-vehicleAssignmentStatusType"
                    >Assignment Type</label
                  >
                </span>
              </div>
            </p-toolbar>
            <p-toolbar [style]="{ 'padding-top': '1.5rem' }">
              <div
                class="p-toolbar-group-start h-color"
                *ngIf="!plateNoSearch && !empNoSearch && !vehicleAssignmentType"
              >
                <strong> Search By :&nbsp; </strong>

                <span class="p-float-label">
                  <p-dropdown
                    [options]="departmentList"
                    (onChange)="getSearchAssignmentByAnyValue($event.value)"
                    optionLabel="department"
                    placeholder="Department"

                    [filter]="true"
                    (onClear)="clearFields()"
                    inputId="float-department"
                    [showClear]="true"
                    filterBy="department"
                    [disabled]="plateNoSearch || empNoSearch || vehicleAssignmentType"
                  >
                  </p-dropdown>
                  <label for="float-department">Department</label>
                </span>
              </div>

              <div
                class="p-toolbar-group-start h-color"
                *ngIf="plateNoSearch || empNoSearch || vehicleAssignmentType"
              >
                <span class="p-float-label">
                  <p-dropdown
                    [options]="departmentList"
                    (onChange)="getSearchAssignmentByAnyValue($event.value)"
                    optionLabel="department"
                    optionValue="department"
                    [(ngModel)]="globalTransformObj.assignToEmpId.department"
                    placeholder="Department"
                    [filter]="true"
                    (onClear)="clearFields()"
                    inputId="float-department"
                    [showClear]="true"
                    filterBy="department"
                    [disabled]="plateNoSearch || empNoSearch || vehicleAssignmentType"
                  >
                  </p-dropdown>
                  <label for="float-department">Department</label>
                </span>
              </div>

              <div
                class="p-toolbar-group-start h-color"
                *ngIf="!plateNoSearch && !empNoSearch && !vehicleAssignmentType"
              >
                <span class="p-float-label">
                  <p-dropdown
                    [options]="sectionList"
                    (onChange)="getSearchAssignmentByAnyValue($event.value)"
                    optionLabel="section"
                    [filter]="true"
                    inputId="float-section"
                    [showClear]="true"
                    (onClear)="clearFields()"
                    filterBy="section"
                    placeholder="Section"
                    [disabled]="plateNoSearch || empNoSearch || vehicleAssignmentType"
                  ></p-dropdown>
                  <label for="float-section">Section</label>
                </span>
              </div>

              <div
                class="p-toolbar-group-start h-color"
                *ngIf="plateNoSearch || empNoSearch || vehicleAssignmentType"
              >
                <span class="p-float-label">
                  <p-dropdown
                    [options]="sectionList"
                    (onChange)="getSearchAssignmentByAnyValue($event.value)"
                    optionLabel="section"
                    optionValue="section"
                    [filter]="true"
                    inputId="float-section"
                    [(ngModel)]="globalTransformObj.assignToEmpId.section"
                    [showClear]="true"
                    (onClear)="clearFields()"
                    filterBy="section"
                    placeholder="Section"
                    [disabled]="plateNoSearch || empNoSearch || vehicleAssignmentType"
                  ></p-dropdown>
                  <label for="float-section">Section</label>
                </span>
              </div>

              <div
                class="p-toolbar-group-start h-color"
                *ngIf="!plateNoSearch && !empNoSearch && !vehicleAssignmentType"
              >
                <span class="p-float-label">
                  <p-dropdown
                    [options]="regionList"
                    (onChange)="getSearchAssignmentByAnyValue($event.value)"
                    optionLabel="region"
                    [filter]="true"
                    inputId="float-region"
                    (onClear)="clearFields()"
                    [showClear]="true"
                    filterBy="region"
                    placeholder="Region"
                    [disabled]="plateNoSearch || empNoSearch || vehicleAssignmentType"
                  ></p-dropdown>
                  <label for="float-region">Region</label>
                </span>
              </div>

              <div
                class="p-toolbar-group-start h-color"
                *ngIf="plateNoSearch || empNoSearch || vehicleAssignmentType"
              >
                <span class="p-float-label">
                  <p-dropdown
                    [options]="regionList"
                    (onChange)="getSearchAssignmentByAnyValue($event.value)"
                    optionLabel="region"
                    optionValue="region"
                    [filter]="true"
                    inputId="float-region"
                    (onClear)="clearFields()"
                    [showClear]="true"
                    [(ngModel)]="globalTransformObj.assignToEmpId.region"
                    filterBy="region"
                    placeholder="Region"
                    [disabled]="plateNoSearch || empNoSearch || vehicleAssignmentType"
                  ></p-dropdown>
                  <label for="float-region">Region</label>
                </span>
              </div>

              <div>
                <h3 class="p-toolbar-group-start h-color">
                  <p-button
                    label="Search"
                    class="bg-b-color"
                    (onClick)="searchCriteria()"
                    icon="pi pi-filter"
                    [disabled]="!criteriaSearch"
                  ></p-button>
                </h3>
              </div>
            </p-toolbar>
            <p-toolbar>
              <div class="p-toolbar-group-start">
                <h2 class="h-color">Fleet Management</h2>
              </div>
            </p-toolbar>
          </div>

          <div class="card">
            <p-table
              [value]="vehicleAssignment"
              [tableStyle]="{ 'min-width': '50rem' }"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="text-center">Plate Number</th>
                  <th class="text-center">Assigned (Emp NO)</th>
                  <th class="text-center">Assigned (Emp Name)</th>
                  <th class="text-center">Design</th>
                  <th class="text-center">Make</th>
                  <th class="text-center">Model</th>
                  <th class="text-center">Year</th>
                  <th class="text-center">Region</th>
                  <th class="text-center">Department</th>
                  <th class="text-center">Section</th>
                  <th class="text-center">Lease Expiry</th>
                  <th class="text-center">Lease Cost</th>

                  <th class="text-center">Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-vehicleAssignment>
                <tr>
                  <td
                    [classList]="
                      vehicleAssignment.vehicle.vehicleStatus === 'Replacement'
                        ? 'text-center color-red'
                        : 'text-center bold-and-color'
                    "
                    class="text-center bold-and-color"
                    id="hoverPlateNumber"
                    (click)="
                      navigateToViewVehicle(vehicleAssignment.vehicle.id)
                    "
                  >
                    {{ vehicleAssignment.vehicle.plateNumber }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.assignToEmpId.employeeNumber }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.assignToEmpName }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.vehicle.design }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.vehicle.make }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.vehicle.model }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.vehicle.year }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.assignToEmpId.region }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.assignToEmpId.department }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.assignToEmpId.section }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.vehicle.leaseExpiryDate }}
                  </td>
                  <td class="text-center">
                    {{ vehicleAssignment.vehicle.leaseCost }}
                  </td>

                  <td
                    class="text-center flex"
                    style="padding-top: 40px; padding-bottom: 40px"
                  >
                    <p-button
                      [routerLink]="['/view-assignment/', vehicleAssignment.id]"
                      pTooltip="View"
                      tooltipPosition="top"
                      icon="bi bi-eye"
                      class="ml mr"
                      [outlined]="true"
                      [rounded]="true"
                      [raised]="true"
                    >
                    </p-button>

                    <p-button
                      (click)="showDialog(vehicleAssignment.id)"
                      icon="bi bi-trash"
                      class="ml"
                      pTooltip="Delete Assignment"
                      tooltipPosition="top"
                      [outlined]="true"
                      [rounded]="true"
                      [raised]="true"
                      severity="danger"
                    >
                    </p-button>

                    <p-button
                      [routerLink]="[
                        '/assignment-attachment',
                        vehicleAssignment.id
                      ]"
                      pTooltip="Add Attachments"
                      tooltipPosition="top"
                      icon="bi bi-paperclip"
                      class="ml mr"
                      [outlined]="true"
                      [rounded]="true"
                      [raised]="true"
                      severity="warning"
                    >
                    </p-button>

                    <p-button
                      [routerLink]="[
                        '/assignment-history/',
                        vehicleAssignment.vehicle.id
                      ]"
                      pTooltip="View History"
                      tooltipPosition="top"
                      icon="bi bi-clock-history"
                      class="ml mr"
                      [outlined]="true"
                      [rounded]="true"
                      [raised]="true"
                      severity="success"
                    ></p-button>

                    <p-button
                      [routerLink]="[
                        '/individual-file-list-component/',
                        'vehicle-assignment',
                        vehicleAssignment.id
                      ]"
                      pTooltip="Download Attachments"
                      tooltipPosition="top"
                      icon="bi bi-download"
                      class="ml mr"
                      [outlined]="true"
                      [rounded]="true"
                      [raised]="true"
                      severity="secondary"
                    >
                    </p-button>
                    <p-button
                      *ngIf="
                        vehicleAssignment.vehicle.vehicleStatus !==
                        'Replacement'
                      "
                      (click)="replaceVehicle(vehicleAssignment.vehicle.id)"
                      pTooltip="Replace Vehicle"
                      tooltipPosition="top"
                      icon="bi bi-arrow-repeat"
                      class="ml mr"
                      [outlined]="true"
                      [rounded]="true"
                      [raised]="true"
                      severity="help"
                    ></p-button>
                    <p-button
                      *ngIf="
                        vehicleAssignment.vehicle.vehicleStatus ===
                        'Replacement'
                      "
                      pTooltip="Take Action"
                      tooltipPosition="top"
                      icon="bi bi-pencil-square"
                      class="ml mr"
                      [outlined]="true"
                      [rounded]="true"
                      [raised]="true"
                      severity="success"
                      (click)="takeAction(vehicleAssignment.vehicle.id)"
                    ></p-button>
                  </td>
                </tr>
                <p-dialog
                  [closable]="false"
                  [(visible)]="visible"
                  [breakpoints]="{ '960px': '75vw' }"
                  [style]="{ width: '50vw' }"
                  [draggable]="false"
                  [resizable]="false"
                  header="Are you Sure you want to delete this assignment?"
                >
                  <p-button
                    icon="pi pi-check"
                    (click)="closeDialog()"
                    label="Close"
                    styleClass="p-button-text"
                  ></p-button>
                  <p-button
                    label="Delete"
                    type="submit"
                    class="bg-b-color ml"
                    (click)="deleteVehicleAssignment(vehicleAssignmentId)"
                  >
                  </p-button>
                </p-dialog>
              </ng-template>
            </p-table>

            <div class="card flex justify-content-center">
              <p-paginator
                [rows]="query.size"
                [first]="query.page * query.size"
                [totalRecords]="totalRecords"
                (onPageChange)="onPageChange($event)"
                [alwaysShow]="false"
                [pageLinkSize]="4"
                [showCurrentPageReport]="true"
              >
              </p-paginator>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
